(define-module (minara-tests sexp)
  :use-module (srfi srfi-11) ;; let-values
  :use-module (oop goops)
  :use-module (unit-test)
  :use-module (minara sexp)
  :use-module (minara buffer))


(define-class <test-sexp> (<test-case>)
  (log #:accessor logo))

(define-method (set-up-test (self <test-sexp>))
  (set! (logo self) 
";; The minara logotype as a minara file
;; Copyright (c) 2004 Rob Myers

(use-modules (minara buffer))

(set-colour 0.8 0.8 0.8 0.0)

(path-begin)
(move-to 5.0 5.0)
(line-to 5.0 395)
(line-to 6.0 395)
(line-to 6.0 5.0)
(path-end)

(path-begin)
(move-to 5.0 395)
(line-to 5.0 396)
(line-to 596.0 396)
(line-to 596.0 395)
(path-end)

(path-begin)
(move-to 595.0 5.0)
(line-to 595.0 395)
(line-to 596.0 395)
(line-to 596.0 5.0)
(path-end)

(path-begin)
(move-to 5.0 5)
(line-to 5.0 6)
(line-to 596.0 6)
(line-to 596.0 5)
(path-end)

(set-colour 0.0 0.828 0.387 1.0)
(push-matrix)
(translate 84 228) ;; Centre on a 600 x 400 window
(path-begin)
(move-to 130.9441 79.3721)
(curve-to 125.2566 77.5049 131.3196 69.6743 125.5374 63.8911)
(curve-to 123.6707 62.0298 121.4358 61.0962 118.9163 61.0962)
(line-to 118.9163 79.7441)
(curve-to 118.9163 84.874 123.113 89.0703 128.2424 89.0703)
(line-to 137.3792 89.0703)
(curve-to 142.509 89.0703 146.7053 84.874 146.7053 79.7441)
(line-to 146.7053 61.0962)
(curve-to 144.1897 61.0962 141.9509 62.0298 140.179 63.8013)
(curve-to 134.302 69.6743 140.365 77.5049 134.6775 79.3721)
(line-to 130.9441 79.3721)

(move-to 243.6045 70.4224)
(curve-to 243.6045 65.2915 239.4082 61.0962 234.2783 61.0962)
(line-to 224.9521 61.0962)
(curve-to 219.8232 61.0962 215.6299 65.2915 215.6299 70.4224)
(line-to 215.6299 79.7441)
(curve-to 215.6299 84.874 219.8232 89.0703 224.9521 89.0703)
(line-to 243.6045 89.0703)
(curve-to 248.7344 89.0703 252.9307 84.874 252.9307 79.7441)
(line-to 252.9307 61.0962)
(curve-to 247.8008 61.0962 243.6045 65.2915 243.6045 70.4224)

(move-to 243.2334 77.042)
(curve-to 242.5801 79.0908 240.9941 79.7441 238.9414 79.7441)
(line-to 224.9521 79.7441)
(curve-to 224.9521 78.3477 224.9521 74.3364 225.3242 73.1235)
(curve-to 225.9775 71.0747 227.5635 70.4224 229.6152 70.4224)
(line-to 243.6045 70.4224)
(curve-to 243.6045 71.8169 243.6045 75.8281 243.2334 77.042)
 
(move-to 207.3291 79.7441)
(line-to 202.8584 79.7441)
(curve-to 200.8096 79.7441 199.2236 79.0908 198.5713 77.042)
(curve-to 198.2002 75.8281 198.2002 71.7271 198.2002 70.4224)
(curve-to 198.2002 67.9028 197.2668 65.6646 195.4983 63.8911)
(curve-to 193.6321 62.0298 191.3938 61.0962 188.8743 61.0962)
(line-to 188.8743 79.7441)
(curve-to 188.8743 84.874 193.0696 89.0703 198.2002 89.0703)
(line-to 216.6543 89.0703)
(curve-to 216.6543 83.9404 212.458 79.7441 207.3291 79.7441)
 
(move-to 94.4856 89.0703)
(line-to 66.5149 89.0703)
(curve-to 61.385 89.0703 57.1887 84.874 57.1887 79.7441)
(line-to 57.1887 61.0962)
(curve-to 59.7083 61.0962 61.947 62.0298 63.8137 63.8911)
(curve-to 69.5959 69.6743 63.533 77.5049 69.2166 79.3721)
(curve-to 70.3396 79.7441 73.8831 79.7441 75.0974 79.7441)
(line-to 75.6516 79.7441)
(line-to 75.6516 61.0962)
(curve-to 78.1707 61.0962 80.4094 62.0298 82.2761 63.8911)
(curve-to 84.0442 65.6646 84.9778 67.9028 84.9778 70.4224)
(curve-to 84.9778 71.7271 84.9778 75.8281 85.3494 77.042)
(line-to 85.2659 79.7441)
(line-to 85.9109 79.7441)
(curve-to 87.1252 79.7441 90.6687 79.7441 91.7844 79.3721)
(curve-to 97.4758 77.5049 91.4124 69.6743 97.2859 63.8013)
(curve-to 99.0618 62.0298 101.3 61.0962 103.8118 61.0962)
(line-to 103.8118 79.7441)
(curve-to 103.8118 84.874 99.6155 89.0703 94.4856 89.0703)
 
(move-to 69.1482 104.2012)
(curve-to 63.2747 98.3242 55.4436 104.3867 53.5769 98.6992)
(curve-to 53.2053 97.5801 53.2053 94.0361 53.2053 92.8223)
(line-to 53.2053 58.6099)
(curve-to 53.2053 57.397 53.2053 53.8521 53.5769 52.7329)
(curve-to 55.4436 47.0454 63.2747 53.1079 69.0569 47.3267)
(curve-to 70.9202 45.4595 71.8538 43.2251 71.8538 40.7056)
(line-to 53.2053 40.7056)
(curve-to 48.0754 40.7056 43.8792 44.9028 43.8792 50.0317)
(line-to 43.8792 101.4014)
(curve-to 43.8792 106.5313 48.0754 110.7271 53.2053 110.7271)
(line-to 71.8538 110.7271)
(curve-to 71.8538 108.2114 70.9202 105.9727 69.1482 104.2012)
 
(move-to 177.0208 70.4224)
(curve-to 177.0208 65.2915 172.8235 61.0962 167.6946 61.0962)
(line-to 158.3684 61.0962)
(curve-to 153.2385 61.0962 149.0461 65.2915 149.0461 70.4224)
(line-to 149.0461 79.7441)
(curve-to 149.0461 84.874 153.2385 89.0703 158.3684 89.0703)
(line-to 177.0208 89.0703)
(curve-to 182.1497 89.0703 186.3469 84.874 186.3469 79.7441)
(line-to 186.3469 61.0962)
(curve-to 181.217 61.0962 177.0208 65.2915 177.0208 70.4224)
 
(move-to 176.6487 77.042)
(curve-to 175.9963 79.0908 174.4104 79.7441 172.3577 79.7441)
(line-to 158.3684 79.7441)
(curve-to 158.3684 78.3477 158.3684 74.3364 158.7395 73.1235)
(curve-to 159.3928 71.0747 160.9788 70.4224 163.0315 70.4224)
(line-to 177.0208 70.4224)
(curve-to 177.0208 71.8169 177.0208 75.8281 176.6487 77.042)
 
(move-to 241.2256 47.231)
(curve-to 247.0986 53.1079 254.9307 47.0454 256.7969 52.7329)
(curve-to 257.1689 53.8521 257.1689 57.397 257.1689 58.6099)
(line-to 257.1689 92.8223)
(curve-to 257.1689 94.0361 257.1689 97.5801 256.7969 98.6992)
(curve-to 254.9307 104.3867 247.0986 98.3242 241.3174 104.1064)
(curve-to 239.4541 105.9727 238.5205 108.2085 238.5205 110.7271)
(line-to 257.1689 110.7271)
(curve-to 262.2979 110.7271 266.4951 106.5313 266.4951 101.4014)
(line-to 266.4951 50.0317)
(curve-to 266.4951 44.9028 262.2979 40.7056 257.1689 40.7056)
(line-to 238.5205 40.7056)
(curve-to 238.5205 43.2212 239.4541 45.4595 241.2256 47.231)
 
(move-to 116.0027 70.4224)
(curve-to 116.0027 67.9028 115.0691 65.6646 113.301 63.8911)
(curve-to 111.4343 62.0298 109.1956 61.0962 106.6765 61.0962)
(line-to 106.6765 79.7441)
(curve-to 106.6765 84.874 110.8728 89.0703 116.0027 89.0703)
(line-to 116.0027 70.4224)
(path-end)
(pop-matrix)"))

(define-method (test-sexp-finding (self <test-sexp>))
  (let-values (((from to) 
		(get-nth-path (logo self) 1)))
	      (assert-equal 134 from)
	      (assert-equal 230 to))
  (let-values (((from to) (get-nth-sexp (logo self) "move-to" 3)))
	      (assert-equal 346 from)
	      (assert-equal 364 to)))
